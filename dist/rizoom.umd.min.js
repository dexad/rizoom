!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Rizoom=s()}(this,function(){"use strict";function t(t,s,i){return Math.min(Math.max(t,s),i)}return class{constructor(t,s,i={}){t&&(this.name="rizoom",this.selector=`${t}, .${this.name}`,this.selectorGallery=s,this.options={duration:.25,...i,labels:{close:"Close Zoom",buttonNext:"Next Image",buttonPrev:"Previous Image",...i.labels},classes:{zoom:"rizoom-zoom",wheel:"rizoom-wheel",overflow:"rizoom-overflow",overlay:"rizoom-overlay",overlayShow:"rizoom-overlay-show",close:"rizoom-button-close",closeShow:"rizoom-button-close-show",button:"rizoom-button",buttonNext:"rizoom-button-next",buttonPrev:"rizoom-button-prev",buttonShow:"rizoom-button-show",...i.classes}},this.image=null,this.ui={buttonNext:null,buttonPrev:null,overlay:null,close:null},this.body=document.body,this.initialized=!1,this.zoomed=!1,this.zoomedTimeout=null,this.isWheel=!1,this.isGallery=!1,this.isDrag=!1,this.rect={},this.current={x:0,y:0,scale:0},this.fit={x:0,y:0,scale:0},this.drag={startX:0,startY:0,x:0,y:0},this.cursor={x:0,y:0},this.gallery={init:!1,images:[],hideImages:[],cache:new Map},this.viewport={width:window.innerWidth,height:window.innerHeight},this.init())}init(){document.addEventListener("click",t=>{if(0!==t.button)return;const s=t.target.closest(this.selector);!this.isDrag&&s&&(this.zoomed?this.close(s):this.open(s))}),this.update();this.createUI("overlay").addEventListener("click",()=>{this.close(this.image)});if(this.createUI("close").addEventListener("click",()=>{this.close(this.image)}),this.selectorGallery){const t=this.createUI("buttonNext"),s=this.createUI("buttonPrev");t.classList.add(this.options.classes.button),s.classList.add(this.options.classes.button),t.addEventListener("click",()=>{this.navigationGallery("next")}),s.addEventListener("click",()=>{this.navigationGallery("prev")})}document.addEventListener("keydown",t=>{"Escape"===t.key&&this.image&&this.close(this.image)}),window.addEventListener("resize",()=>{this.viewport.width=window.innerWidth,this.viewport.height=window.innerHeight}),document.addEventListener("wheel",this.handleWheel.bind(this),{passive:!1});let t=null,s=!1;document.addEventListener("mousedown",i=>{this.isWheel&&0===i.button&&i.target.closest(this.selector)&&(i.preventDefault(),clearTimeout(t),s=!0,this.drag.startX=i.clientX,this.drag.startY=i.clientY,this.drag.x=this.current.x,this.drag.y=this.current.y)},{passive:!1}),document.addEventListener("mouseup",i=>{s&&(s=!1,t=setTimeout(()=>{this.isDrag=!1},10))}),document.addEventListener("mousemove",t=>{if(this.image&&(this.cursor.x=t.clientX,this.cursor.y=t.clientY,s)){const s=t.clientX-this.drag.startX,i=t.clientY-this.drag.startY;(Math.abs(i)>3||Math.abs(s)>3)&&(this.isDrag=!0),this.current.x=this.limitPosition(this.drag.x+s,"width"),this.current.y=this.limitPosition(this.drag.y+i,"height"),this.image.style.translate=`${this.current.x}px ${this.current.y}px`}})}update(){document.querySelectorAll(`${this.selector}:not(.${this.name})`).forEach(t=>{t.classList.add(this.name),t.setAttribute("tabindex","0"),t.setAttribute("role","img"),t.setAttribute("aria-label","Zoom Image"),t.setAttribute("aria-expanded","false"),t.addEventListener("keydown",s=>{"Enter"===s.key?this.zoomed?this.close(t):this.open(t):"Tab"===s.key&&this.close(t)})})}open(t){this.zoomed=!0,this.image=t,this.calculateFit(),this.applyTransform(),t.classList.contains(this.name)||t.classList.add(this.name),this.body.classList.add(this.options.classes.overflow),this.ui.overlay?.classList.add(this.options.classes.overlayShow);const s=!!this.selectorGallery&&t.closest(this.selectorGallery);if(s){let t;this.gallery.cache.has(s)?t=this.gallery.cache.get(s):(t=Array.from(s.querySelectorAll(this.selector)),this.gallery.cache.set(s,t)),this.gallery.images=t,this.isGallery=!0,this.showButtons()}clearTimeout(this.zoomedTimeout),t.classList.add(this.options.classes.zoom),t.setAttribute("aria-expanded","true")}calculateFit(){this.rect=this.image.getBoundingClientRect(),this.fit=this.current={scale:Math.min(this.viewport.width/this.rect.width,this.viewport.height/this.rect.height),x:this.viewport.width/2-(this.rect.left+this.rect.width/2),y:this.viewport.height/2-(this.rect.top+this.rect.height/2)}}applyTransform(){const{x:t,y:s,scale:i}=this.current;this.image.style.scale=i,this.image.style.translate=`${t}px ${s}px`}close(t){t.style.transitionDuration="",t.style.scale="",t.style.translate="",t.classList.remove(this.options.classes.wheel),t.setAttribute("aria-expanded","false"),this.body.classList.remove(this.options.classes.overflow),this.ui.overlay?.classList.remove(this.options.classes.overlayShow),this.ui.buttonNext?.classList.remove(this.options.classes.buttonShow),this.ui.buttonPrev?.classList.remove(this.options.classes.buttonShow),this.zoomedTimeout=setTimeout(()=>{t.classList.remove(this.options.classes.zoom)},1e3*this.options.duration),this.image=null,this.zoomed=this.isDrag=this.isWheel=this.isGallery=!1}handleWheel(s){if(!this.image)return;s.preventDefault();const i=t(this.current.scale*2**(.001*s.wheelDelta),this.fit.scale,this.fit.scale+2),e=this.current.scale;if(i===e)return;const o=this.cursor.x-this.viewport.width/2,h=this.cursor.y-this.viewport.height/2,a=i/e,r=this.fit.scale===i;this.current={scale:i,x:this.limitPosition(o-(o-(this.current.x-this.fit.x))*a+this.fit.x,"width",i),y:this.limitPosition(h-(h-(this.current.y-this.fit.y))*a+this.fit.y,"height",i)},this.isWheel=!r,this.image.classList.toggle(this.options.classes.wheel,!r),this.image.style.transitionDuration=r?"":"0s",this.applyTransform()}showButtons(){const t=this.gallery.images.indexOf(this.image);this.ui.buttonNext?.classList.toggle(this.options.classes.buttonShow,t<this.gallery.images.length-1),this.ui.buttonPrev?.classList.toggle(this.options.classes.buttonShow,t>0)}getHidePosition(t){const s=this.rect.width*this.current.scale,i=s+this.viewport.width/2-s/2;return"next"===t?-i+this.current.x:i+this.current.x}navigationGallery(t){const{image:s,current:i}=this,{images:e,hideImages:o}=this.gallery,h=e.indexOf(s),a="next"===t,r=a?e[h+1]:e[h-1];r&&(o.push(s),s.style.transitionDuration="",s.style.translate=`${this.getHidePosition(t)}px ${i.y}px`,setTimeout(()=>{o.forEach(t=>{t.classList.remove(this.name,this.options.classes.zoom),t.style.transitionDuration="0s",t.style.translate="",t.style.scale="",t.offsetHeight,t.style.transitionDuration="",o.shift()})},1e3*this.options.duration),this.image=r,this.calculateFit(),this.showButtons(),r.style.transitionDuration="0s",r.style.translate=`${this.getHidePosition(a?"prev":"next")}px ${i.y}px`,r.style.scale=this.current.scale,r.classList.add(this.name,this.options.classes.zoom),r.offsetHeight,r.style.transitionDuration="",r.style.translate=`${this.current.x}px ${this.current.y}px`)}createUI(t){const s=document.createElement("button");return this.options.labels[t]&&s.setAttribute("aria-label",this.options.labels[t]),s.classList.add(this.options.classes[t]),this.body.appendChild(s),this.ui[t]=s,s}limitPosition(s,i,e=this.current.scale){const o="width"===i?"x":"y",h=this.viewport[i],a=this.rect[i]*e;if(a<=h)return this.fit[o];const r=(a-h)/2;return t(s,this.fit[o]-r,this.fit[o]+r)}}});
